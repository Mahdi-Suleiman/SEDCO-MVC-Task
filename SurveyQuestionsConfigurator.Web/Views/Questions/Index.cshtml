@model IEnumerable<SurveyQuestionsConfigurator.Entities.Question>

@{
    ViewBag.Title = "Index";
}

<h2>@SurveyQuestionsConfigurator.Entities.Resources.LanguageStrings.Questions</h2>
@*badge text-bg-primary*@
<p>
    @Html.ActionLink(SurveyQuestionsConfigurator.Entities.Resources.LanguageStrings.Create, "Create", new { }, htmlAttributes: new { @class = "btn btn-primary", @style = "padding: 4px 8px;" })
</p>
<table class="table table-hover" id="myTable">
    <thead>

        <tr>
            <th onclick="w3.sortHTML('#myTable', '.toBeRemoved', 'td:nth-child(1)')" style="cursor:pointer">
                @Html.DisplayNameFor(model => model.Order)
            </th>
            <th onclick="w3.sortHTML('#myTable', '.toBeRemoved', 'td:nth-child(2)')" style="cursor:pointer">
                @Html.DisplayNameFor(model => model.Type)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Text)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr class="toBeRemoved">
                <td>
                    @Html.DisplayFor(modelItem => item.Order)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Type)
                </td>
                <td>
                    @Html.TextAreaFor(modelItem => item.Text, htmlAttributes: new { @class = "form-control", rows = "3", style = "min-width: 80%;resize:vertical", @readonly = "true" })
                </td>
                <td>
                    @Html.ActionLink(SurveyQuestionsConfigurator.Entities.Resources.LanguageStrings.Edit, "Edit", new { id = item.ID, type = item.Type }, htmlAttributes: new { @class = "btn btn-success" }) |
                    @Html.ActionLink(SurveyQuestionsConfigurator.Entities.Resources.LanguageStrings.Details, "Details", new { id = item.ID, type = item.Type }, htmlAttributes: new { @class = "btn btn-info" }) |
                    @Html.ActionLink(SurveyQuestionsConfigurator.Entities.Resources.LanguageStrings.Delete, "Delete", new { id = item.ID, type = item.Type }, htmlAttributes: new { @class = "btn btn-danger" })
                </td>
            </tr>
        }
    </tbody>
</table>

@section scripts {
    <script src="https://www.w3schools.com/lib/w3.js"></script>

    @*Script references.
        The jQuery library is required and is referenced by default in _Layout.cshtml.
        Reference the SignalR library.*@
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    @*Reference the autogenerated SignalR hub script.*@
    <script src="~/signalr/hubs"></script>
    @*SignalR script to update the tQuestionsHub page and send messages.*@
    <script>
    ///Get culture Info from server, to decide
    const cultureInfo = "@System.Globalization.CultureInfo.CurrentCulture.Name"
    const tEnglish = "en-US"

        $(function () {
            // Reference the auto-generated proxy for the hub.
            const tQuestionsHub = $.connection.questionsHub;
            // Create a function that the hub can call back to display messages.
            tQuestionsHub.client.RefreshQuestionsList = function (pQuestionList) {
                /// Clear all rows
                $('.toBeRemoved').remove(); ///Remove <tr> tags with ".toBeRemoved" class

                /// Map from int(DB values) to string, used in <a> tags and table columns
                const tQuestionsType = ["SMILEY", "SLIDER", "STAR"]
                const tArabicQuestionsType = ["وجه مبتسم", "شريط", "نجمة"]

                /// Add rows to the table.
                pQuestionList.forEach((tQuestion, index) => {
                    $('#myTable tbody').append(`
                            <tr class="toBeRemoved">
                                <td>${tQuestion.Order}</td>
                                <td>
                                ${cultureInfo == tEnglish ? tQuestionsType[tQuestion.Type] : tArabicQuestionsType[tQuestion.Type] }
                                </td>
                                <td>
                                    <textarea class="form-control" cols="20" data-val="true" data-val-maxlength="The field Text must be a string or array type with a maximum length of '3999'." data-val-maxlength-max="3999" data-val-required="The Text field is required." id="item_Text" name="item.Text" readonly="true"
                                    rows="3" style="min-width: 80%;resize:vertical">${tQuestion.Text}</textarea>
                                </td>

                                <td>
                                    <a class="btn btn-success" href="/Questions/Edit/${tQuestion.ID}?type=${tQuestionsType[tQuestion.Type]}">${cultureInfo == tEnglish? "Edit" : "تعديل"}</a> |
                                    <a class="btn btn-info" href="/Questions/Details/${tQuestion.ID}?type=${tQuestionsType[tQuestion.Type]}">${cultureInfo == tEnglish ? "Details" : "التفاصيل"}</a> |
                                    <a class="btn btn-danger" href="/Questions/Delete/${tQuestion.ID}?type=${tQuestionsType[tQuestion.Type]}">${cultureInfo == tEnglish ? "Delete" : "حذف"}</a>
                                </td>
                            </tr>
                            `);
                })
            };

            // Start the connection.
            $.connection.hub.start();
        });
    </script>

}