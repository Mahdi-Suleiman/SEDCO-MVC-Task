@model IEnumerable<SurveyQuestionsConfigurator.Entities.Question>

@{
    ViewBag.Title = "Index";
}

<h2>Questions</h2>
@*badge text-bg-primary*@
<p>
    @Html.ActionLink("Create", "Create", new { }, htmlAttributes: new { @class = "btn btn-primary", @style = "padding: 4px 8px;" })
</p>
<table class="table table-hover" id="myTable">
    <thead>

        <tr>
            <th scope="col"></th>
            <th>
                @Html.DisplayNameFor(model => model.Order)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Type)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Text)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr class="toBeRemoved">
                <th scope="row"></th>
                <td>
                    @Html.DisplayFor(modelItem => item.Order)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Type)
                </td>
                <td>
                    @Html.TextAreaFor(modelItem => item.Text, htmlAttributes: new { @class = "form-control", rows = "3", style = "min-width: 80%;resize:vertical", @readonly = "true" })
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", new { id = item.ID, type = item.Type }, htmlAttributes: new { @class = "btn btn-success" }) |
                    @Html.ActionLink("Details", "Details", new { id = item.ID, type = item.Type }, htmlAttributes: new { @class = "btn btn-info" }) |
                    @Html.ActionLink("Delete", "Delete", new { id = item.ID, type = item.Type }, htmlAttributes: new { @class = "btn btn-danger" })
                </td>
            </tr>
        }
    </tbody>
</table>

@section scripts {

    @*Script references.
        The jQuery library is required and is referenced by default in _Layout.cshtml.
        Reference the SignalR library.*@
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    @*Reference the autogenerated SignalR hub script.*@
    <script src="~/signalr/hubs"></script>
    @*SignalR script to update the tQuestionsHub page and send messages.*@
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            const tQuestionsHub = $.connection.questionsHub;
            // Create a function that the hub can call back to display messages.
            tQuestionsHub.client.RefreshQuestionsList = function (pQuestionList) {
                /// Clear all rows
                $('.toBeRemoved').remove(); ///Remove <tr> tags with ".toBeRemoved" class

                /// Map from int(DB values) to string, used in <a> tags and table columns
                const tQuestionsType = ["SMILEY", "SLIDER", "STAR"]

                /// Add rows to the table.
                pQuestionList.forEach((tQuestion, index) => {
                    $('#myTable tbody').append(`
                            <tr class="toBeRemoved">
                                <th scope="row"></th>
                                <td>${tQuestion.Order}</td>
                                <td>${tQuestionsType[tQuestion.Type]}</td>
                                <td>
                                    <textarea class="form-control" cols="20" data-val="true" data-val-maxlength="The field Text must be a string or array type with a maximum length of '3999'." data-val-maxlength-max="3999" data-val-required="The Text field is required." id="item_Text" name="item.Text" readonly="true"
                                    rows="3" style="min-width: 80%;resize:vertical">${tQuestion.Text}</textarea>
                                </td>

                                <td>
                                    <a class="btn btn-success" href="/Questions/Edit/${tQuestion.ID}?type=${tQuestionsType[tQuestion.Type]}">Edit</a> |
                                    <a class="btn btn-info" href="/Questions/Details/${tQuestion.ID}?type=${tQuestionsType[tQuestion.Type]}">Details</a> |
                                    <a class="btn btn-danger" href="/Questions/Delete/${tQuestion.ID}?type=${tQuestionsType[tQuestion.Type]}">Delete</a>
                                </td>
                            </tr>
                            `);
                })
            };

            // Start the connection.
            $.connection.hub.start();
        });
    </script>

}